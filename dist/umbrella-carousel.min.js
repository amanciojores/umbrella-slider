(()=>{var r=class{constructor(t){this.carousel=t,this.track=t.querySelector(".umbrella__list"),this.originalSlides=Array.from(this.track.children),this.prevBtn=t.querySelector(".umbrella__prev"),this.nextBtn=t.querySelector(".umbrella__next"),this.paginationContainer=t.querySelector(".umbrella__pagination"),this.breakpoints=this.getBreakpoints(),this.rafId=null,this.resizeTimeout=null,this.intersectionObserver=null,this.lazyImages=new Set,this.init()}getBreakpoints(){try{return this.carousel.dataset.breakpoints?JSON.parse(this.carousel.dataset.breakpoints):{}}catch(t){return console.error("Invalid breakpoints JSON",t),{}}}getResponsiveSettings(){let t={itemsPerPage:parseInt(this.carousel.dataset.itemsPerPage)||1,pagesPerMove:parseInt(this.carousel.dataset.pagesPerMove)||1,autoplay:!0,delay:3e3,sliderType:this.carousel.dataset.sliderType||"loop",pagination:this.carousel.dataset.pagination==="true",syncBanners:this.carousel.dataset.syncBanners==="true",lazyLoad:this.carousel.dataset.lazyLoad==="true"};try{let e=JSON.parse(this.carousel.dataset.autoplay||"{}");e&&Object.keys(e).length>0&&(t.autoplay=e.autoPlay===!0,e.delay&&(t.delay=parseInt(e.delay)))}catch(e){console.error("Invalid autoplay JSON",e)}let s=Object.entries(this.breakpoints).filter(([e])=>window.innerWidth<=parseInt(e)).map(([,e])=>e);return s.length?{...t,...s[0]}:t}init(){this.settings=this.getResponsiveSettings(),this.index=this.settings.sliderType==="loop"?this.settings.pagesPerMove:0,this.slideWidth=100/this.settings.itemsPerPage,this.cloneCount=this.settings.sliderType==="loop"?Math.max(this.settings.pagesPerMove,this.settings.itemsPerPage):0,this.updateSliderTypeClass(),this.setupSlides(),this.setupPagination(),this.addEventListeners(),this.updateNavigationVisibility(),this.setupLazyLoading(),this.settings.lazyLoad&&(this.settings.sliderType==="fade"?this.updateFadeVisibility():this.updateVisibility()),this.setupIntersectionObserver(),this.settings.syncBanners&&this.setupBannerSync(),this.settings.autoplay&&this.startAutoplay()}updateSliderTypeClass(){this.carousel.classList.remove("umbrella--fade","umbrella--slide","umbrella--loop"),this.carousel.classList.add(`umbrella--${this.settings.sliderType}`)}setupSlides(){if(this.track.innerHTML="",this.originalSlides.forEach(t=>{t.style.opacity="1",this.track.appendChild(t)}),this.settings.sliderType==="loop")for(let t=0;t<this.cloneCount;t++){let s=this.originalSlides[t%this.originalSlides.length].cloneNode(!0),e=this.originalSlides[this.originalSlides.length-1-t%this.originalSlides.length].cloneNode(!0);s.removeAttribute("id"),e.removeAttribute("id"),s.dataset.clone=e.dataset.clone="true",this.track.appendChild(s),this.track.insertBefore(e,this.track.firstChild)}this.slides=Array.from(this.track.children),this.track.style.width=`${this.slides.length*this.slideWidth}%`,this.slides.forEach(t=>{t.style.width=`${this.slideWidth}%`,t.style.position="",t.style.top="",t.style.left="",t.style.zIndex="",t.classList.remove("umbrella__slide__visible"),t.style.transition=this.settings.sliderType==="fade"?"opacity 0.5s ease":""}),this.settings.sliderType==="fade"?this.updateFadeVisibility():(this.updateCarouselPosition(),this.updateVisibility())}updateCarousel(){if(this.settings.sliderType==="fade"){this.updateFadeVisibility(),this.syncActiveBanner();return}this.settings.sliderType==="slide"&&this.clampIndexForSlideType(),this.rafId=requestAnimationFrame(()=>{this.track.style.transition="transform 0.5s ease-in-out",this.updateCarouselPosition(),this.track.addEventListener("transitionend",()=>{this.settings.sliderType==="loop"&&(this.index<=0?this.index=this.slides.length-this.cloneCount*2:this.index>=this.slides.length-this.cloneCount&&(this.index=this.cloneCount),this.track.style.transition="none",this.updateCarouselPosition()),this.updateVisibility(),this.syncActiveBanner()},{once:!0}),this.updatePagination()})}updateCarouselPosition(){this.track.style.transform=`translate3d(-${this.index*this.slideWidth}%, 0, 0)`}clampIndexForSlideType(){let t=this.slides.length-this.settings.itemsPerPage;this.index=Math.max(0,Math.min(this.index,t))}updateVisibility(){this.slides.forEach((t,s)=>{let e=s>=this.index&&s<this.index+this.settings.itemsPerPage;t.setAttribute("aria-hidden",!e),t.classList.toggle("umbrella__slide__visible",e),e&&this.settings.lazyLoad&&this.loadSlideImages(t)})}updateFadeVisibility(){this.slides.forEach((t,s)=>{let e=s===this.index;t.style.opacity=e?"1":"0",t.style.zIndex=e?"1":"0",t.classList.toggle("umbrella__slide__visible",e),e&&this.settings.lazyLoad&&this.loadSlideImages(t)}),this.updatePagination()}setupPagination(){if(!(!this.settings.pagination||!this.paginationContainer)){if(this.paginationBullets=Array.from(this.paginationContainer.querySelectorAll(".umbrella__pagination__bullet")),this.paginationBullets.length===0){let t=Math.ceil(this.originalSlides.length/this.settings.pagesPerMove);for(let s=0;s<t;s++){let e=document.createElement("button");e.className="umbrella__pagination__bullet",e.setAttribute("aria-label",`Go to slide ${s+1}`),e.dataset.index=s,this.paginationContainer.appendChild(e),this.paginationBullets.push(e)}}else this.paginationBullets.forEach((t,s)=>{t.dataset.index=s});this.paginationContainer.addEventListener("click",t=>{let s=t.target.closest(".umbrella__pagination__bullet");if(!s)return;let e=parseInt(s.dataset.index);this.index=this.settings.sliderType==="fade"?e:this.cloneCount+e*this.settings.pagesPerMove,this.updateCarousel(),this.stopAutoplay()}),this.updatePagination()}}updatePagination(){if(!this.paginationBullets)return;let t=this.settings.sliderType==="fade"?this.index:Math.floor((this.index-this.cloneCount)/this.settings.pagesPerMove);this.paginationBullets.forEach((s,e)=>s.classList.toggle("active",e===t))}startAutoplay(){this.stopAutoplay(),this.autoplayInterval=setInterval(()=>{this.settings.sliderType==="fade"?this.index=(this.index+1)%this.slides.length:(this.index+=this.settings.pagesPerMove,this.settings.sliderType==="slide"&&this.index>this.slides.length-this.settings.itemsPerPage&&(this.index=0)),this.updateCarousel()},this.settings.delay)}stopAutoplay(){this.autoplayInterval&&(clearInterval(this.autoplayInterval),this.autoplayInterval=null)}loadVisibleImages(){if(!this.settings.lazyLoad)return;(this.settings.sliderType==="fade"?[this.slides[this.index]]:this.slides.slice(this.index,this.index+this.settings.itemsPerPage)).forEach(s=>{s.querySelectorAll("img[data-src]").forEach(i=>{this.lazyImages.has(i)&&(i.src=i.dataset.src,i.removeAttribute("data-src"),this.lazyImages.delete(i),i.classList.add("lazy-loading"),i.addEventListener("load",()=>{i.classList.remove("lazy-loading"),i.classList.add("lazy-loaded")},{once:!0}))})})}updateNavigationVisibility(){let t=this.settings.sliderType==="slide"&&this.originalSlides.length<=this.settings.itemsPerPage;this.prevBtn&&(this.prevBtn.style.display=t?"none":""),this.nextBtn&&(this.nextBtn.style.display=t?"none":""),this.paginationContainer&&(this.paginationContainer.style.display=t?"none":"")}addEventListeners(){this.prevBtn?.addEventListener("click",()=>{this.settings.sliderType==="fade"?this.index=(this.index-1+this.slides.length)%this.slides.length:this.index-=this.settings.pagesPerMove,this.updateCarousel(),this.stopAutoplay()}),this.nextBtn?.addEventListener("click",()=>{this.settings.sliderType==="fade"?this.index=(this.index+1)%this.slides.length:this.index+=this.settings.pagesPerMove,this.updateCarousel(),this.stopAutoplay()}),this.carousel.setAttribute("tabindex","0"),this.carousel.addEventListener("keydown",s=>{s.key==="ArrowRight"&&this.nextBtn?.click(),s.key==="ArrowLeft"&&this.prevBtn?.click()});let t=0;this.carousel.addEventListener("touchstart",s=>{t=s.touches[0].clientX},{passive:!0}),this.carousel.addEventListener("touchend",s=>{let e=s.changedTouches[0].clientX,i=t-e;Math.abs(i)>50&&(i>0?this.nextBtn?.click():this.prevBtn?.click())},{passive:!0}),this.handleResize=this.debounce(()=>{let s=this.getResponsiveSettings(),e=s.itemsPerPage!==this.settings.itemsPerPage||s.sliderType!==this.settings.sliderType||s.pagesPerMove!==this.settings.pagesPerMove;this.settings=s,this.slideWidth=100/this.settings.itemsPerPage,this.cloneCount=this.settings.sliderType==="loop"?Math.max(this.settings.pagesPerMove,this.settings.itemsPerPage):0,e?(this.index=this.settings.sliderType==="loop"?this.settings.pagesPerMove:0,this.updateSliderTypeClass(),this.setupSlides(),this.setupPagination(),this.setupLazyLoading(),this.settings.lazyLoad&&this.loadVisibleImages()):(this.updateSliderTypeClass(),this.slideWidth=100/this.settings.itemsPerPage,this.track.style.width=`${this.slides.length*this.slideWidth}%`,this.slides.forEach(i=>{i.style.width=`${this.slideWidth}%`}),requestAnimationFrame(()=>{this.settings.sliderType==="fade"?this.updateFadeVisibility():(this.updateCarouselPosition(),this.updateVisibility())})),this.updateNavigationVisibility()},200),window.addEventListener("resize",this.handleResize,{passive:!0})}debounce(t,s){return(...e)=>{this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>t(...e),s)}}setupIntersectionObserver(){"IntersectionObserver"in window&&(this.intersectionObserver=new IntersectionObserver(t=>{t.forEach(s=>{s.isIntersecting?this.settings.autoplay&&!this.autoplayInterval&&this.startAutoplay():this.autoplayInterval&&this.stopAutoplay()})},{threshold:.1}),this.intersectionObserver.observe(this.carousel))}setupLazyLoading(){let t=this.carousel.querySelectorAll("img[data-src]");this.settings.lazyLoad?t.forEach(s=>{this.lazyImages.add(s),s.classList.add("lazy-load-pending")}):(t.forEach(s=>{s.src=s.dataset.src,s.removeAttribute("data-src"),s.classList.remove("lazy-load-pending","lazy-loading"),s.classList.add("lazy-load-complete")}),this.lazyImages.clear())}loadSlideImages(t){t.querySelectorAll("img[data-src]").forEach(e=>{this.lazyImages.has(e)&&(e.src=e.dataset.src,e.removeAttribute("data-src"),this.lazyImages.delete(e),e.classList.add("lazy-loading"),e.addEventListener("load",()=>{e.classList.remove("lazy-loading"),e.classList.add("lazy-loaded")},{once:!0}))})}setupBannerSync(){let t=this.carousel.closest(".umbrella-banner");if(!t)return;let s=t.querySelectorAll(".banner-card"),e=this.settings.sliderType==="fade";s.forEach((i,n)=>{let l=()=>{this.index=e?n:this.settings.sliderType==="loop"?this.cloneCount+n*this.settings.pagesPerMove:n,this.updateCarousel(),e||this.stopAutoplay()},o=e?"mouseenter":"click";i.addEventListener(o,l,{passive:!0})})}syncActiveBanner(){if(!this.settings.syncBanners)return;let t=this.carousel.closest(".umbrella-banner");if(!t)return;let s=t.querySelectorAll(".banner-card"),e=this.settings.sliderType==="fade"?this.index:(this.index-this.cloneCount+this.originalSlides.length)%this.originalSlides.length;s.forEach((i,n)=>{i.classList.toggle("active",n===e)})}destroy(){this.stopAutoplay(),this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.rafId&&cancelAnimationFrame(this.rafId),window.removeEventListener("resize",this.handleResize),this.intersectionObserver&&this.intersectionObserver.disconnect(),this.lazyImages.clear()}};document.addEventListener("DOMContentLoaded",()=>{window.umbrellaCarousels={},document.querySelectorAll(".umbrella__slider").forEach((a,t)=>{let s=a.id||`carousel-${t}`;a.id=s,window.umbrellaCarousels[s]=new r(a)}),document.querySelectorAll(".umbrella-banner").forEach(a=>{a.querySelectorAll("*").forEach(t=>{for(let s of t.attributes){if(!s.name.startsWith("data-on"))continue;let e=s.name.slice(7).toLowerCase(),i=s.value;e&&typeof t[`on${e}`]<"u"&&t.addEventListener(e,n=>{try{new Function("event",`"use strict"; try { ${i} } catch(err) { 
                    console.warn("Event handler error:", err); 
                  }`).call(t,n)}catch(l){console.warn(`Error in data-on${e}:`,l)}},{passive:!1})}})})});window.cleanupUmbrellaCarousels=()=>{window.umbrellaCarousels&&typeof window.umbrellaCarousels=="object"&&(Object.values(window.umbrellaCarousels).forEach(a=>{a&&typeof a.destroy=="function"&&a.destroy()}),window.umbrellaCarousels={})};})();
