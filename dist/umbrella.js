class UmbrellaCarousel{constructor(t){this.carousel=t,this.track=t.querySelector(".umbrella__list"),this.originalSlides=Array.from(this.track.children),this.prevBtn=t.querySelector(".umbrella__prev"),this.nextBtn=t.querySelector(".umbrella__next"),this.paginationContainer=t.querySelector(".umbrella__pagination"),this.breakpoints=this.getBreakpoints(),this.rafId=null,this.resizeTimeout=null,this.intersectionObserver=null,this.lazyImages=new Set,this.init()}getBreakpoints(){try{return this.carousel.dataset.breakpoints?JSON.parse(this.carousel.dataset.breakpoints):{}}catch(t){return console.error("Invalid breakpoints JSON",t),{}}}getResponsiveSettings(){const t={itemsPerPage:parseInt(this.carousel.dataset.itemsPerPage)||1,pagesPerMove:parseInt(this.carousel.dataset.pagesPerMove)||1,autoplay:!0,delay:3e3,sliderType:this.carousel.dataset.sliderType||"loop",pagination:"true"===this.carousel.dataset.pagination,syncBanners:"true"===this.carousel.dataset.syncBanners,lazyLoad:"true"===this.carousel.dataset.lazyLoad};try{const e=JSON.parse(this.carousel.dataset.autoplay||"{}");e&&Object.keys(e).length>0&&(t.autoplay=!0===e.autoPlay,e.delay&&(t.delay=parseInt(e.delay)))}catch(t){console.error("Invalid autoplay JSON",t)}const e=Object.entries(this.breakpoints).filter((([t])=>window.innerWidth<=parseInt(t))).map((([,t])=>t));return e.length?{...t,...e[0]}:t}init(){this.settings=this.getResponsiveSettings(),this.index="loop"===this.settings.sliderType?this.settings.pagesPerMove:0,this.slideWidth=100/this.settings.itemsPerPage,this.cloneCount="loop"===this.settings.sliderType?Math.max(this.settings.pagesPerMove,this.settings.itemsPerPage):0,this.updateSliderTypeClass(),this.setupSlides(),this.setupPagination(),this.addEventListeners(),this.updateNavigationVisibility(),this.setupLazyLoading(),this.settings.lazyLoad&&("fade"===this.settings.sliderType?this.updateFadeVisibility():this.updateVisibility()),this.setupIntersectionObserver(),this.settings.syncBanners&&this.setupBannerSync(),this.settings.autoplay&&this.startAutoplay()}updateSliderTypeClass(){this.carousel.classList.remove("umbrella--fade","umbrella--slide","umbrella--loop"),this.carousel.classList.add(`umbrella--${this.settings.sliderType}`)}setupSlides(){if(this.track.innerHTML="",this.originalSlides.forEach((t=>{t.style.opacity="1",this.track.appendChild(t)})),"loop"===this.settings.sliderType)for(let t=0;t<this.cloneCount;t++){const e=this.originalSlides[t%this.originalSlides.length].cloneNode(!0),s=this.originalSlides[this.originalSlides.length-1-t%this.originalSlides.length].cloneNode(!0);e.removeAttribute("id"),s.removeAttribute("id"),e.dataset.clone=s.dataset.clone="true",this.track.appendChild(e),this.track.insertBefore(s,this.track.firstChild)}this.slides=Array.from(this.track.children),this.track.style.width=this.slides.length*this.slideWidth+"%",this.slides.forEach((t=>{t.style.width=`${this.slideWidth}%`,t.style.position="",t.style.top="",t.style.left="",t.style.zIndex="",t.classList.remove("umbrella__slide__visible"),t.style.transition="fade"===this.settings.sliderType?"opacity 0.5s ease":""})),"fade"===this.settings.sliderType?this.updateFadeVisibility():(this.updateCarouselPosition(),this.updateVisibility())}updateCarousel(){if("fade"===this.settings.sliderType)return this.updateFadeVisibility(),void this.syncActiveBanner();"slide"===this.settings.sliderType&&this.clampIndexForSlideType(),this.rafId=requestAnimationFrame((()=>{this.track.style.transition="transform 0.5s ease-in-out",this.updateCarouselPosition(),this.track.addEventListener("transitionend",(()=>{"loop"===this.settings.sliderType&&(this.index<=0?this.index=this.slides.length-2*this.cloneCount:this.index>=this.slides.length-this.cloneCount&&(this.index=this.cloneCount),this.track.style.transition="none",this.updateCarouselPosition()),this.updateVisibility(),this.syncActiveBanner()}),{once:!0}),this.updatePagination()}))}updateCarouselPosition(){this.track.style.transform=`translate3d(-${this.index*this.slideWidth}%, 0, 0)`}clampIndexForSlideType(){const t=this.slides.length-this.settings.itemsPerPage;this.index=Math.max(0,Math.min(this.index,t))}updateVisibility(){this.slides.forEach(((t,e)=>{const s=e>=this.index&&e<this.index+this.settings.itemsPerPage;t.setAttribute("aria-hidden",!s),t.classList.toggle("umbrella__slide__visible",s),s&&this.settings.lazyLoad&&this.loadSlideImages(t)}))}updateFadeVisibility(){this.slides.forEach(((t,e)=>{const s=e===this.index;t.style.opacity=s?"1":"0",t.style.zIndex=s?"1":"0",t.classList.toggle("umbrella__slide__visible",s),s&&this.settings.lazyLoad&&this.loadSlideImages(t)})),this.updatePagination()}setupPagination(){if(this.settings.pagination&&this.paginationContainer){if(this.paginationBullets=Array.from(this.paginationContainer.querySelectorAll(".umbrella__pagination__bullet")),0===this.paginationBullets.length){const t=Math.ceil(this.originalSlides.length/this.settings.pagesPerMove);for(let e=0;e<t;e++){const t=document.createElement("button");t.className="umbrella__pagination__bullet",t.setAttribute("aria-label",`Go to slide ${e+1}`),t.dataset.index=e,this.paginationContainer.appendChild(t),this.paginationBullets.push(t)}}else this.paginationBullets.forEach(((t,e)=>{t.dataset.index=e}));this.paginationContainer.addEventListener("click",(t=>{const e=t.target.closest(".umbrella__pagination__bullet");if(!e)return;const s=parseInt(e.dataset.index);this.index="fade"===this.settings.sliderType?s:this.cloneCount+s*this.settings.pagesPerMove,this.updateCarousel(),this.stopAutoplay()})),this.updatePagination()}}updatePagination(){if(!this.paginationBullets)return;const t="fade"===this.settings.sliderType?this.index:Math.floor((this.index-this.cloneCount)/this.settings.pagesPerMove);this.paginationBullets.forEach(((e,s)=>e.classList.toggle("active",s===t)))}startAutoplay(){this.stopAutoplay(),this.autoplayInterval=setInterval((()=>{"fade"===this.settings.sliderType?this.index=(this.index+1)%this.slides.length:(this.index+=this.settings.pagesPerMove,"slide"===this.settings.sliderType&&this.index>this.slides.length-this.settings.itemsPerPage&&(this.index=0)),this.updateCarousel()}),this.settings.delay)}stopAutoplay(){this.autoplayInterval&&(clearInterval(this.autoplayInterval),this.autoplayInterval=null)}loadVisibleImages(){if(!this.settings.lazyLoad)return;("fade"===this.settings.sliderType?[this.slides[this.index]]:this.slides.slice(this.index,this.index+this.settings.itemsPerPage)).forEach((t=>{t.querySelectorAll("img[data-src]").forEach((t=>{this.lazyImages.has(t)&&(t.src=t.dataset.src,t.removeAttribute("data-src"),this.lazyImages.delete(t),t.classList.add("lazy-loading"),t.addEventListener("load",(()=>{t.classList.remove("lazy-loading"),t.classList.add("lazy-loaded")}),{once:!0}))}))}))}updateNavigationVisibility(){const t="slide"===this.settings.sliderType&&this.originalSlides.length<=this.settings.itemsPerPage;this.prevBtn&&(this.prevBtn.style.display=t?"none":""),this.nextBtn&&(this.nextBtn.style.display=t?"none":""),this.paginationContainer&&(this.paginationContainer.style.display=t?"none":"")}addEventListeners(){this.prevBtn?.addEventListener("click",(()=>{"fade"===this.settings.sliderType?this.index=(this.index-1+this.slides.length)%this.slides.length:this.index-=this.settings.pagesPerMove,this.updateCarousel(),this.stopAutoplay()})),this.nextBtn?.addEventListener("click",(()=>{"fade"===this.settings.sliderType?this.index=(this.index+1)%this.slides.length:this.index+=this.settings.pagesPerMove,this.updateCarousel(),this.stopAutoplay()})),this.carousel.setAttribute("tabindex","0"),this.carousel.addEventListener("keydown",(t=>{"ArrowRight"===t.key&&this.nextBtn?.click(),"ArrowLeft"===t.key&&this.prevBtn?.click()}));let t=0;this.carousel.addEventListener("touchstart",(e=>{t=e.touches[0].clientX}),{passive:!0}),this.carousel.addEventListener("touchend",(e=>{const s=e.changedTouches[0].clientX,i=t-s;Math.abs(i)>50&&(i>0?this.nextBtn?.click():this.prevBtn?.click())}),{passive:!0}),this.handleResize=this.debounce((()=>{const t=this.getResponsiveSettings(),e=t.itemsPerPage!==this.settings.itemsPerPage||t.sliderType!==this.settings.sliderType||t.pagesPerMove!==this.settings.pagesPerMove;this.settings=t,this.slideWidth=100/this.settings.itemsPerPage,this.cloneCount="loop"===this.settings.sliderType?Math.max(this.settings.pagesPerMove,this.settings.itemsPerPage):0,e?(this.index="loop"===this.settings.sliderType?this.settings.pagesPerMove:0,this.updateSliderTypeClass(),this.setupSlides(),this.setupPagination(),this.setupLazyLoading(),this.settings.lazyLoad&&this.loadVisibleImages()):(this.updateSliderTypeClass(),this.slideWidth=100/this.settings.itemsPerPage,this.track.style.width=this.slides.length*this.slideWidth+"%",this.slides.forEach((t=>{t.style.width=`${this.slideWidth}%`})),requestAnimationFrame((()=>{"fade"===this.settings.sliderType?this.updateFadeVisibility():(this.updateCarouselPosition(),this.updateVisibility())}))),this.updateNavigationVisibility()}),200),window.addEventListener("resize",this.handleResize,{passive:!0})}debounce(t,e){return(...s)=>{this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout((()=>t(...s)),e)}}setupIntersectionObserver(){"IntersectionObserver"in window&&(this.intersectionObserver=new IntersectionObserver((t=>{t.forEach((t=>{t.isIntersecting?this.settings.autoplay&&!this.autoplayInterval&&this.startAutoplay():this.autoplayInterval&&this.stopAutoplay()}))}),{threshold:.1}),this.intersectionObserver.observe(this.carousel))}setupLazyLoading(){const t=this.carousel.querySelectorAll("img[data-src]");this.settings.lazyLoad?t.forEach((t=>{this.lazyImages.add(t),t.classList.add("lazy-load-pending")})):(t.forEach((t=>{t.src=t.dataset.src,t.removeAttribute("data-src"),t.classList.remove("lazy-load-pending","lazy-loading"),t.classList.add("lazy-load-complete")})),this.lazyImages.clear())}loadSlideImages(t){t.querySelectorAll("img[data-src]").forEach((t=>{this.lazyImages.has(t)&&(t.src=t.dataset.src,t.removeAttribute("data-src"),this.lazyImages.delete(t),t.classList.add("lazy-loading"),t.addEventListener("load",(()=>{t.classList.remove("lazy-loading"),t.classList.add("lazy-loaded")}),{once:!0}))}))}setupBannerSync(){const t=this.carousel.closest(".umbrella-banner");if(!t)return;const e=t.querySelectorAll(".banner-card"),s="fade"===this.settings.sliderType;e.forEach(((t,e)=>{const i=s?"mouseenter":"click";t.addEventListener(i,(()=>{this.index=s?e:"loop"===this.settings.sliderType?this.cloneCount+e*this.settings.pagesPerMove:e,this.updateCarousel(),s||this.stopAutoplay()}),{passive:!0})}))}syncActiveBanner(){if(!this.settings.syncBanners)return;const t=this.carousel.closest(".umbrella-banner");if(!t)return;const e=t.querySelectorAll(".banner-card"),s="fade"===this.settings.sliderType?this.index:(this.index-this.cloneCount+this.originalSlides.length)%this.originalSlides.length;e.forEach(((t,e)=>{t.classList.toggle("active",e===s)}))}destroy(){this.stopAutoplay(),this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.rafId&&cancelAnimationFrame(this.rafId),window.removeEventListener("resize",this.handleResize),this.intersectionObserver&&this.intersectionObserver.disconnect(),this.lazyImages.clear()}}document.addEventListener("DOMContentLoaded",(()=>{window.umbrellaCarousels={},document.querySelectorAll(".umbrella__slider").forEach(((t,e)=>{const s=t.id||`carousel-${e}`;t.id=s,window.umbrellaCarousels[s]=new UmbrellaCarousel(t)})),document.querySelectorAll(".umbrella-banner").forEach((t=>{t.querySelectorAll("*").forEach((t=>{for(const e of t.attributes){if(!e.name.startsWith("data-on"))continue;const s=e.name.slice(7).toLowerCase(),i=e.value;s&&void 0!==t[`on${s}`]&&t.addEventListener(s,(e=>{try{new Function("event",`"use strict"; try { ${i} } catch(err) { \n                    console.warn("Event handler error:", err); \n                  }`).call(t,e)}catch(t){console.warn(`Error in data-on${s}:`,t)}}),{passive:!1})}}))}))})),window.cleanupUmbrellaCarousels=()=>{window.umbrellaCarousels&&"object"==typeof window.umbrellaCarousels&&(Object.values(window.umbrellaCarousels).forEach((t=>{t&&"function"==typeof t.destroy&&t.destroy()})),window.umbrellaCarousels={})};